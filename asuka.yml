# title: 飛鳥配列
# rules:
# - description: 飛鳥配列
#   manipulators:

# ===== Aliases =====

# ----- Modifier Keys -----

- var/from/modifiers: &opt_shift_key
    optional:
    - shift

- var/to/modifiers: &shift_key
  - shift

# ----- Kana Shift Keys -----

- var/to: &turn_on_same_hand_shift
  - set_variable:
      name: same_hand_shifted
      value: 1

- var/to_after_key_up: &turn_off_same_hand_shift
  - set_variable:
      name: same_hand_shifted
      value: 0

- var/to: &turn_on_reverse_hand_shift
  - set_variable:
      name: reverse_hand_shifted
      value: 1

- var/to_after_key_up: &turn_off_reverse_hand_shift
  - set_variable:
      name: reverse_hand_shifted
      value: 0

# ----- Conditions -----

- var/conditions: &ja_input
  - type: input_source_if
    input_sources:
    - language: ja

- var/conditions: &base_state
  - type: input_source_if
    input_sources:
    - language: ja
  - type: variable_unless
    name: kana_layout_invalid
    value: 1
  - type: variable_unless
    name: kana_system_mode
    value: 1

- var/conditions: &same_hand_shifted
  - type: input_source_if
    input_sources:
    - language: ja
  - type: variable_unless
    name: kana_layout_invalid
    value: 1
  - type: variable_if
    name: same_hand_shifted
    value: 1
  - type: variable_unless
    name: kana_system_mode
    value: 1

- var/conditions: &reverse_hand_shifted
  - type: input_source_if
    input_sources:
    - language: ja
  - type: variable_unless
    name: kana_layout_invalid
    value: 1
  - type: variable_if
    name: reverse_hand_shifted
    value: 1
  - type: variable_unless
    name: kana_system_mode
    value: 1

# ===== 同手・逆手シフトキー =====

# ----- 同手シフト時 -----

# あ
- type: basic
  from:
    key_code: s
    modifiers: *opt_shift_key
  to:
  - key_code: a
    repeat: false
  conditions: *same_hand_shifted

# が
- type: basic
  from:
    key_code: d
    modifiers: *opt_shift_key
  to:
  - key_code: g
    repeat: false
  - key_code: a
    repeat: false
  conditions: *same_hand_shifted

# こ
- type: basic
  from:
    key_code: l
    modifiers: *opt_shift_key
  to:
  - key_code: k
    repeat: false
  - key_code: o
    repeat: false
  conditions: *same_hand_shifted

# の
- type: basic
  from:
    key_code: k
    modifiers: *opt_shift_key
  to:
  - key_code: "n"
    repeat: false
  - key_code: o
    repeat: false
  conditions: *same_hand_shifted

# ----- 逆手シフト時 -----

# お
- type: basic
  from:
    key_code: s
    modifiers: *opt_shift_key
  to:
  - key_code: o
    repeat: false
  conditions: *reverse_hand_shifted

# な
- type: basic
  from:
    key_code: d
    modifiers: *opt_shift_key
  to:
  - key_code: "n"
    repeat: false
  - key_code: a
    repeat: false
  conditions: *reverse_hand_shifted

# ま
- type: basic
  from:
    key_code: l
    modifiers: *opt_shift_key
  to:
  - key_code: m
    repeat: false
  - key_code: a
    repeat: false
  conditions: *reverse_hand_shifted

# す
- type: basic
  from:
    key_code: k
    modifiers: *opt_shift_key
  to:
  - key_code: s
    repeat: false
  - key_code: u
    repeat: false
  conditions: *reverse_hand_shifted

# ----- ベース面-----

# し（同手シフトキー）
- type: basic
  from:
    key_code: s
    modifiers: *opt_shift_key
  to_if_alone:
  - key_code: s
    repeat: false
  - key_code: i
    repeat: false
  to: *turn_on_same_hand_shift
  to_after_key_up: *turn_off_same_hand_shift
  conditions: *base_state

# か（同手シフトキー）
- type: basic
  from:
    key_code: l
    modifiers: *opt_shift_key
  to_if_alone:
  - key_code: k
    repeat: false
  - key_code: a
    repeat: false
  to: *turn_on_same_hand_shift
  to_after_key_up: *turn_off_same_hand_shift
  conditions: *base_state

# う（逆手シフトキー）
- type: basic
  from:
    key_code: d
    modifiers: *opt_shift_key
  to_if_alone:
  - key_code: u
    repeat: false
  to: *turn_on_reverse_hand_shift
  to_after_key_up: *turn_off_reverse_hand_shift
  conditions: *base_state

# い（逆手シフトキー）
- type: basic
  from:
    key_code: k
    modifiers: *opt_shift_key
  to_if_alone:
  - key_code: i
    repeat: false
  to: *turn_on_reverse_hand_shift
  to_after_key_up: *turn_off_reverse_hand_shift
  conditions: *base_state

# ===== 同手シフト =====

# kana
- type: basic
  from:
    key_code: from_key
    modifiers: *opt_shift_key
  to:
  - key_code: to_key
    repeat: false
  - key_code: to_key
    repeat: false
  conditions: *same_hand_shifted

# ===== 逆手シフト =====

# kana
- type: basic
  from:
    key_code: from_key
    modifiers: *opt_shift_key
  to:
  - key_code: to_key
    repeat: false
  - key_code: to_key
    repeat: false
  conditions: *reverse_hand_shifted

# ===== ベース =====

# kana
- type: basic
  from:
    key_code: from_key
    modifiers: *opt_shift_key
  to:
  - key_code: to_key
    repeat: false
  - key_code: to_key
    repeat: false
  conditions: *base_state
