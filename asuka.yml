# title: 飛鳥配列
# rules:
# - description: 飛鳥配列
#   manipulators:

# ===== Aliases =====

# ----- Modifier Keys -----

- var/from/modifiers: &opt_shift_key
    optional:
    - shift

- var/to/modifiers: &shift_key
  - shift

# ----- Kana Shift Keys -----

- var/to: &turn_on_same_hand_shift
  - set_variable:
      name: same_hand_shifted
      value: 1

- var/to_after_key_up: &turn_off_same_hand_shift
  - set_variable:
      name: same_hand_shifted
      value: 0

- var/to: &turn_on_reverse_hand_shift
  - set_variable:
      name: reverse_hand_shifted
      value: 1

- var/to_after_key_up: &turn_off_reverse_hand_shift
  - set_variable:
      name: reverse_hand_shifted
      value: 0

# ----- Conditions -----

- var/conditions: &ja_input
  - type: input_source_if
    input_sources:
    - language: ja

- var/conditions: &system_mode
  - type: variable_if
    name: system_mode
    value: 1

- var/conditions: &base_state
  - type: input_source_if
    input_sources:
    - language: ja
  - type: variable_unless
    name: kana_layout_invalid
    value: 1
  - type: variable_unless
    name: system_mode
    value: 1

- var/conditions: &same_hand_shifted
  - type: input_source_if
    input_sources:
    - language: ja
  - type: variable_unless
    name: kana_layout_invalid
    value: 1
  - type: variable_unless
    name: system_mode
    value: 1
  - type: variable_if
    name: same_hand_shifted
    value: 1

- var/conditions: &reverse_hand_shifted
  - type: input_source_if
    input_sources:
    - language: ja
  - type: variable_unless
    name: kana_layout_invalid
    value: 1
  - type: variable_unless
    name: system_mode
    value: 1
  - type: variable_if
    name: reverse_hand_shifted
    value: 1

# ===== System Mode =====

# System Mode Key
- type: basic
  from:
    key_code: q
  to_if_alone:
  - key_code: null
    repeat: false
  to:
  - set_variable:
      name: system_mode
      value: 1
  to_after_key_up:
  - set_variable:
      name: system_mode
      value: 0

# 飛鳥配列を中断
- type: basic
  from:
    key_code: o
  to:
  - set_variable: &turn_off_kana_layout
      name: kana_layout_invalid
      value: 1
  conditions: *system_mode

# 飛鳥配列を再開（日本語入力オン）
- type: basic
  from:
    key_code: i
  to:
  - set_variable: &turn_on_kana_layout
      name: kana_layout_invalid
      value: 0
  - key_code: japanese_kana
    repeat: false
  conditions: *system_mode

# ===== 同手・逆手シフトキー =====

# ----- 同手シフト時 -----

# あ
- type: basic
  from:
    key_code: s
    modifiers: *opt_shift_key
  to:
  - key_code: a
    repeat: false
  conditions: *same_hand_shifted

# が
- type: basic
  from:
    key_code: d
    modifiers: *opt_shift_key
  to:
  - key_code: g
    repeat: false
  - key_code: a
    repeat: false
  conditions: *same_hand_shifted

# こ
- type: basic
  from:
    key_code: l
    modifiers: *opt_shift_key
  to:
  - key_code: k
    repeat: false
  - key_code: o
    repeat: false
  conditions: *same_hand_shifted

# の
- type: basic
  from:
    key_code: k
    modifiers: *opt_shift_key
  to:
  - key_code: "n"
    repeat: false
  - key_code: o
    repeat: false
  conditions: *same_hand_shifted

# ----- 逆手シフト時 -----

# お
- type: basic
  from:
    key_code: s
    modifiers: *opt_shift_key
  to:
  - key_code: o
    repeat: false
  conditions: *reverse_hand_shifted

# な
- type: basic
  from:
    key_code: d
    modifiers: *opt_shift_key
  to:
  - key_code: "n"
    repeat: false
  - key_code: a
    repeat: false
  conditions: *reverse_hand_shifted

# ま
- type: basic
  from:
    key_code: l
    modifiers: *opt_shift_key
  to:
  - key_code: m
    repeat: false
  - key_code: a
    repeat: false
  conditions: *reverse_hand_shifted

# す
- type: basic
  from:
    key_code: k
    modifiers: *opt_shift_key
  to:
  - key_code: s
    repeat: false
  - key_code: u
    repeat: false
  conditions: *reverse_hand_shifted

# ----- ベース面-----

# し（同手シフトキー）
- type: basic
  from:
    key_code: s
    modifiers: *opt_shift_key
  to_if_alone:
  - key_code: s
    repeat: false
  - key_code: i
    repeat: false
  to: *turn_on_same_hand_shift
  to_after_key_up: *turn_off_same_hand_shift
  conditions: *base_state

# か（同手シフトキー）
- type: basic
  from:
    key_code: l
    modifiers: *opt_shift_key
  to_if_alone:
  - key_code: k
    repeat: false
  - key_code: a
    repeat: false
  to: *turn_on_same_hand_shift
  to_after_key_up: *turn_off_same_hand_shift
  conditions: *base_state

# う（逆手シフトキー）
- type: basic
  from:
    key_code: d
    modifiers: *opt_shift_key
  to_if_alone:
  - key_code: u
    repeat: false
  to: *turn_on_reverse_hand_shift
  to_after_key_up: *turn_off_reverse_hand_shift
  conditions: *base_state

# い（逆手シフトキー）
- type: basic
  from:
    key_code: k
    modifiers: *opt_shift_key
  to_if_alone:
  - key_code: i
    repeat: false
  to: *turn_on_reverse_hand_shift
  to_after_key_up: *turn_off_reverse_hand_shift
  conditions: *base_state

# ===== 同手シフト =====

# kana
- type: basic
  from:
    key_code: from_key
    modifiers: *opt_shift_key
  to:
  - key_code: to_key
    repeat: false
  - key_code: to_key
    repeat: false
  conditions: *same_hand_shifted

# あ
# く
# け
# こ
# せ
# そ
# つ
# ぬ
# ね
# の
# ひ
# む
# め
# も
# ろ
# を

# が
# ご（Bracket）
# ご（Delete）
# ぜ
# ぞ
# だ
# ぢ
# づ
# ど
# ば
# ぼ

# ぴ

# ぁ
# ぃ
# ぅ
# ぇ
# ぉ

# 開き丸括弧
# 閉じ丸括弧
# 小なり
# 大なり
# 疑問符
# コロン
# ダブルクォーテーション

# ===== 逆手シフト =====

# kana
- type: basic
  from:
    key_code: from_key
    modifiers: *opt_shift_key
  to:
  - key_code: to_key
    repeat: false
  - key_code: to_key
    repeat: false
  conditions: *reverse_hand_shifted

# え
# お
# す
# な
# ふ
# へ
# ま
# み
# や
# よ
# ら
# る
# れ
# わ

# ぐ
# げ
# ざ
# ず
# で
# べ

# ぱ
# ぷ
# ぺ

# ヴ

# 開き二重鉤括弧
# 閉じ二重鉤括弧
# 開き鉤括弧
# 閉じ鉤括弧
# コンマ
# ピリオド
# スラッシュ
# セミコロン
# シングルクォーテーション
# 開き丸括弧
# 閉じ丸括弧
# チルダ
# 感嘆符
# アスタリスク
# 読点
# 句点
# 疑問符

# ===== ベース =====

# kana
- type: basic
  from:
    key_code: from_key
    modifiers: *opt_shift_key
  to:
  - key_code: to_key
    repeat: false
  - key_code: to_key
    repeat: false
  conditions: *base_state

# い
# う
# か
# き
# さ
# し
# た
# ち
# て
# と
# に
# は
# ほ
# ゆ
# り
# ん

# ぎ
# じ
# び
# ぶ

# ぽ

# っ
# ゃ
# ゅ
# ょ

# 長音符
# パーセント

# Return
# Delete
# Esc
