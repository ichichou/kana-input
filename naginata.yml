# ---------- Variables ----------

# from - key_code
- var: &dakuon_right j

- var: &dakuon_left f

- var: &handakuon_right m

- var: &handakuon_left v

- var: &kogaki q

# from - modifiers
- var: &any
    optional:
      - any

# to
- var: &set_invalid
    name: invalid
    value: 1

- var: &set_shifted
  - set_variable:
      name: shifted
      value: 1

# to_after_key_up
- var: &unset_invalid
  - set_variable:
      name: invalid
      value: 0

- var: &unset_shifted
  - set_variable:
      name: shifted
      value: 0

# conditions
- var: &common_state
  - type: input_source_if
    input_sources:
      - language: ja
  - type: variable_unless
    name: invalid
    value: 1

- var: &shifted_state
    - type: input_source_if
      input_sources:
        - language: ja
    - type: variable_unless
      name: invalid
      value: 1
    - type: variable_if
      name: shifted
      value: 1

# ---------- 修飾キー押下時は無効化 ----------

# Command
- type: basic
  from:
    key_code: command
  to:
    - set_variable: *set_invalid
    - key_code: command
  to_after_key_up: *unset_invalid
  conditions: *common_state

# Control
- type: basic
  from:
    key_code: control
  to:
    - set_variable: *set_invalid
    - key_code: control
  to_after_key_up: *unset_invalid
  conditions: *common_state

# Option
- type: basic
  from:
    key_code: option
  to:
    - set_variable: *set_invalid
    - key_code: option
  to_after_key_up: *unset_invalid
  conditions: *common_state

# ---------- センターシフト ----------

# - type: basic
#   from:
#     key_code: return_or_enter
#     modifiers: *any
#   to: *set_shifted
#   to_if_alone:
#     - key_code: return_or_enter
#       repeat: false
#   to_after_key_up: *unset_shifted
#   conditions: *common_state

# ---------- 中指シフト ----------

# に（シフト）
- type: basic
  from:
    key_code: d
    modifiers: *any
  to:
    - key_code: n
      repeat: false
    - key_code: i
      repeat: false
  conditions: *shifted_state

# も（シフト）
- type: basic
  from:
    key_code: k
    modifiers: *any
  to:
    - key_code: m
      repeat: false
    - key_code: o
      repeat: false
  conditions: *shifted_state

# と（単打）
- type: basic
  from:
    key_code: d
    modifiers: *any
  to: *set_shifted
  to_if_alone:
    - key_code: t
      repeat: false
    - key_code: o
      repeat: false
  to_after_key_up: *unset_shifted
  conditions: *common_state

# い（単打）
- type: basic
  from:
    key_code: k
    modifiers: *any
  to: *set_shifted
  to_if_alone:
    - key_code: i
      repeat: false
  to_after_key_up: *unset_shifted
  conditions: *common_state

# ---------- 外来音（濁音） ----------

# kana
- type: basic
  from:
    simultaneous:
      - key_code: *dakuon_right
      - key_code: from_key
      - key_code: from_key
    modifiers: *any
  to:
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
  conditions: *common_state

# ---------- 外来音（清音） ----------

# kana
- type: basic
  from:
    simultaneous:
      - key_code: *handakuon_right
      - key_code: from_key
      - key_code: from_key
    modifiers: *any
  to:
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
  conditions: *common_state

# ---------- 拗音（半濁音） ----------

# kana
- type: basic
  from:
    simultaneous:
      - key_code: *handakuon_right
      - key_code: from_key
      - key_code: from_key
    modifiers: *any
  to:
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
  conditions: *common_state

# kana
- type: basic
  from:
    simultaneous:
      - key_code: *handakuon_left
      - key_code: from_key
      - key_code: from_key
    modifiers: *any
  to:
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
  conditions: *common_state

# ---------- 拗音（濁音） ----------

# kana
- type: basic
  from:
    simultaneous:
      - key_code: *dakuon_right
      - key_code: from_key
      - key_code: from_key
    modifiers: *any
  to:
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
  conditions: *common_state

# kana
- type: basic
  from:
    simultaneous:
      - key_code: *dakuon_left
      - key_code: from_key
      - key_code: from_key
    modifiers: *any
  to:
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
  conditions: *common_state

# ---------- 拗音（清音） ----------

# kana
- type: basic
  from:
    simultaneous:
      - key_code: from_key
      - key_code: from_key
    modifiers: *any
  to:
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
  conditions: *common_state

# ---------- 小書き ----------

# kana
- type: basic
  from:
    simultaneous:
      - key_code: *kogaki
      - key_code: from_key
    modifiers: *any
  to:
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
  conditions: *common_state

# ---------- 半濁音 ----------

# kana
- type: basic
  from:
    simultaneous:
      - key_code: *handakuon_right
      - key_code: from_key
    modifiers: *any
  to:
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
  conditions: *common_state

# kana
- type: basic
  from:
    simultaneous:
      - key_code: *handakuon_left
      - key_code: from_key
    modifiers: *any
  to:
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
  conditions: *common_state

# ---------- 濁音 ----------

# kana
- type: basic
  from:
    simultaneous:
      - key_code: *dakuon_right
      - key_code: from_key
    modifiers: *any
  to:
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
  conditions: *common_state

# kana
- type: basic
  from:
    simultaneous:
      - key_code: *dakuon_left
      - key_code: from_key
    modifiers: *any
  to:
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
  conditions: *common_state

# ---------- 清音（シフト） ----------
# 中指シフトの場合、「に・も」はコメントアウトする

# kana
- type: basic
  from:
    key_code: from_key
    modifiers: *any
  to:
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
  conditions: *shifted_state

# ---------- 清音（単打） ----------
# 中指シフトの場合、「と・い」はコメントアウトする

# kana
- type: basic
  from:
    key_code: from_key
    modifiers: *any
  to:
    - key_code: to_key
      repeat: false
    - key_code: to_key
      repeat: false
  conditions: *common_state
